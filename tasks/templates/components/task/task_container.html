<div id="tasks" class="row shadow p-4 mt-3 bg-body-tertiary rounded border-top border-3">

    <div class="pb-3 d-flex justify-content-between px-4">
        <h4>Задачи</h4>

    </div>


    <div class="row">

        <div class="col-md-4 d-flex px-4 gap-3">
            <div>
                <span class=" fs-6 text">Активные ({{ not_done_count }})</span>
            </div>
            <div>
                <span class=" fs-6 text">Завершенные ({{ done_count }})</span>
            </div>

        </div>
        <div class="col-md-4 gap-2 border-start border-2">
            <div class="form-check form-switch">
                <!-- Переключатель "Показывать активные задачи" -->
                <input class="form-check-input form-check-lg" type="checkbox" role="switch"
                       id="showActiveTasksSwitch"
                       onchange="updateUrl()"
                       {% if show_active_task %}checked{% endif %}>
                <label class="form-check-label" for="showActiveTasksSwitch"
                       style="font-size: 18px; margin-right: 10px;">
                    Показывать активные задачи
                </label>
            </div>

            <div class="form-check form-switch">
                <!-- Переключатель "Показывать завершённые задачи" -->
                <input class="form-check-input form-check-lg" type="checkbox" role="switch"
                       id="showDoneTasksSwitch"
                       onchange="updateUrl()"
                       {% if show_done_task %}checked{% endif %}>
                <label class="form-check-label" for="showDoneTasksSwitch"
                       style="font-size: 18px;">
                    Показывать завершённые задачи
                </label>
            </div>
        </div>

        {% if show_my_tasks_only or sort_order %}
            <div class="col-md-4 gap-2 px-4">
                <div class="form-check form-switch">
                    <!-- Переключатель "Показывать только мои задачи" -->
                    <input class="form-check-input" type="checkbox" role="switch"
                           id="showMyTasksOnlySwitch"
                           onchange="updateUrl()"
                           {% if show_my_tasks_only %}checked{% endif %}>
                    <label class="form-check-label" for="showMyTasksOnlySwitch"
                           style="font-size: 18px; margin-right: 10px;">
                        Показывать только мои задачи
                    </label>
                </div>

                <div class="form-check form-switch">
                    <!-- Переключатель порядка сортировки задач -->
                    <input class="form-check-input" type="checkbox" role="switch"
                           id="sortOrderSwitch"
                           onchange="updateUrl()"
                           {% if sort_order == 'desc' %}checked{% endif %}>
                    <label class="form-check-label" for="sortOrderSwitch"
                           style="font-size: 18px;">
                        {% if sort_order == 'desc' %}Новые вначале{% else %}Старые вначале{% endif %}
                    </label>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="d-flex justify-content-start px-4 mt-3">
        {% include "components/task/create_task.html" %}
    </div>

    {% if tasks %}


        <div class="tab-content mt-4" id="myTabContent">
        <!-- Вкладка активных задач -->
        <div class="tab-pane fade show active">
            {% for task in tasks %}
                {% include "components/task/task.html" with task=task %}

            {% endfor %}
        </div>


    {% else %}
        <div class="d-flex justify-content-left mt-3">Задач для отображения нет.</div>
    {% endif %}
    </div>
    {% include 'components/home/../pagination.html' with pagination_data=pagination_data filter_data=filter_data %}

</div>

<script>
    function updateUrl() {
        const showActiveTasks = document.getElementById('showActiveTasksSwitch').checked;
        const showDoneTasks = document.getElementById('showDoneTasksSwitch').checked;
        const showMyTasksOnly = document.getElementById('showMyTasksOnlySwitch') ? document.getElementById('showMyTasksOnlySwitch').checked : null;
        const sortOrder = document.getElementById('sortOrderSwitch') ? (document.getElementById('sortOrderSwitch').checked ? 'desc' : 'asc') : null;

        const currentUrl = new URL(window.location.href);
        const params = new URLSearchParams(currentUrl.search);

        // Устанавливаем параметры
        params.set('show_active_task', showActiveTasks);
        params.set('show_done_task', showDoneTasks);
        if (showMyTasksOnly !== null) params.set('show_my_tasks_only', showMyTasksOnly);
        if (sortOrder !== null) params.set('sort_order', sortOrder);

        // Обновляем URL
        window.location.search = params.toString();
    }
</script>